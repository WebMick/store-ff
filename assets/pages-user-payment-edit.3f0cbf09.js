import{G as a,u as e,r as l,c as s,aF as o,d as t,e as u,w as r,i as n,h as d,j as i,x as c,t as m,n as v,m as p,k as _,f,a8 as g,H as y,q as w,v as h}from"./index-1326579e.js";import{_ as b}from"./uni-easyinput.bcff0311.js";import{_ as k,a as N,r as $}from"./uni-app.es.a60443e8.js";import{_ as V,a as U}from"./uni-forms.67fb2978.js";import{_ as x}from"./w-loading.4fc13da4.js";import{_ as B}from"./ano-popup.0d0d982a.js";import{B as C,g as I,u as j,z as M,C as P}from"./user.2b7a6c52.js";import"./uni-icons.e2da828d.js";const D=e=>{a({icon:"none",duration:2e3,...e})},T=k({__name:"edit",setup(k){const{t:T}=e(),q=f(),z=l(!1),F=s((()=>q.state.userinfo)),J=s((()=>q.state.configInfo)),S=()=>{I({userId:q.state.userinfo.userId}).then((a=>{200===a.data.code&&q.commit("setUserinfo",a.data.result)})).finally((()=>{z.value=!1}))};S();const A=l({type:0,realName:"",accountNo:"",bankCode:"",branch:"",isDefault:1,imgUrl:""}),G=a=>{console.log(a,/\S{5}/.test(a),a.replace(/\s/g,"").replace(/(.{4})/g,"$1 ")),/\S{5}/.test(a)&&(A.value.accountNo=a.replace(/\s/g,"").replace(/(.{4})/g,"$1 "))},H=s((()=>(console.log(A.value.accountNo),!!A.value.accountNo&&!/^\d{11,16}$/.test(A.value.accountNo.replace(/\s/g,"")))));let L="",R=T("user.t125");const E=l("");N((a=>{L=a.id,E.value=a.payMode,A.value.type=a.type||0,a.id&&(R=T("user.t126"),o({title:R}),z.value=!0,C({id:a.id}).then((a=>{var e,l,s,o,t,u;200===a.data.code?A.value={realName:null==(e=a.data.result)?void 0:e.realName,accountNo:null==(l=a.data.result)?void 0:l.accountNo,branch:null==(s=a.data.result)?void 0:s.branch,bankCode:null==(o=a.data.result)?void 0:o.bankCode,isDefault:null==(t=a.data.result)?void 0:t.isDefault,imgUrl:null==(u=a.data.result)?void 0:u.imgUrl}:D({title:a.data.message})})).catch((a=>{D({title:T("message.t1")})})).finally((()=>{z.value=!1})))}));const K={realName:[{required:!0,errorMessage:T("user.t127")}],accountNo1:[{required:!0,errorMessage:T("user.t128")}],accountNo2:[{required:!0,errorMessage:T("user.t129")}],accountNo3:[{required:!0,errorMessage:T("user.t130")}],bankCode:[{required:!0,errorMessage:T("user.t171")}]},O=l(!1),Q=l(!0),W=l({password1:"",password2:""}),X=l("password1"),Y=e=>{let l=setTimeout((()=>{if(clearTimeout(l),6==W.value[X.value].length){if(F.value.isJyPassword)return O.value=!1,Q.value=!1,void sa();if("password1"==X.value){O.value=!1,Q.value=!1;let a=setTimeout((()=>{clearTimeout(a),X.value="password2",O.value=!0}),350)}if("password2"==X.value){if(O.value=!1,W.value.password1!=W.value.password2)return X.value="password1",W.value.password1="",W.value.password2="",void a({title:T("user.t134"),icon:"none",duration:2e3});sa().finally((()=>{X.value="password1",W.value.password1="",W.value.password2=""}))}}}),17)},Z=l({});function aa(e){g({count:1,sourceType:["album"],success(e){Z.value=e.tempFiles[0],Z.value.size>1048576?a({title:T("user.t30"),icon:"none",duration:2e3}):(e=>{if(!(e.size>1048576))return j({name:"file",filePath:e.path,formData:{biz:"pay"}});a({title:T("user.t30"),icon:"none",duration:2e3})})(Z.value).then((e=>{200===e.code?(console.log({res:e}),A.value.imgUrl=e.result):a({title:e.message,icon:"none",duration:2e3})})).catch((e=>{a({title:T("user.133"),icon:"none",duration:2e3})}))},fail(e){a({title:e,icon:"none",duration:2e3})}})}const ea=l(null),la=()=>{var a;null==(a=ea.value)||a.validate().then((a=>{console.log(a),A.value.type?O.value=!0:sa()}))};function sa(){let e={...A.value,userId:q.state.userinfo.userId,payMode:E.value,status:1,imgUrl:A.value.imgUrl,accountNo:A.value.accountNo.replace(/\s/g,""),jyPassword:W.value.password1};L&&(e.id=L);let l=L?M:P;return z.value=!0,l(e).then((e=>{if(200!==e.data.code)return void a({title:e.data.message,icon:"none",duration:2e3});S(),a({title:T(L?"user.t135":"user.t136"),icon:"success",duration:2e3});let l=setTimeout((()=>{clearTimeout(l),y({delta:L?1:2})}),2e3)})).catch((e=>{a({title:T("message.t1"),icon:"none",duration:2e3})})).finally((()=>{z.value=!1}))}return(a,e)=>{const l=$(w("uni-easyinput"),b),s=$(w("uni-forms-item"),V),o=h("van-image"),f=h("van-switch"),g=$(w("uni-forms"),U),y=h("van-button"),k=$(w("w-loading"),x),N=h("van-icon"),C=h("van-password-input"),I=h("van-number-keyboard"),j=$(w("ano-popup"),B),M=n;return t(),u(M,{class:"ano-page ano-payment"},{default:r((()=>[d(g,{class:"ano-form payment-form",ref_key:"formRef",ref:ea,rules:K},{default:r((()=>[d(s,{class:"ano-form__item",name:"realName"},{default:r((()=>[i("div",{class:"ano-form__label"},[i("span",{class:"ano-asterisk"},"*"),c(m(a.$t("user.t106")),1)]),i("div",{class:"ano-form__cnt"},[d(l,{type:"text",modelValue:A.value.realName,"onUpdate:modelValue":e[0]||(e[0]=a=>A.value.realName=a),placeholder:a.$t("user.t1061"),rules:K.realName,inputBorder:!1,maxlength:"20",clearable:""},null,8,["modelValue","placeholder","rules"])])])),_:1}),"UPI"===E.value?(t(),u(s,{key:0,class:"ano-form__item",name:"accountNo"},{default:r((()=>[i("div",{class:"ano-form__label"},[i("span",{class:"ano-asterisk"},"*"),c(m(a.$t("user.t107")),1)]),i("div",{class:"ano-form__cnt"},[d(l,{type:"text",modelValue:A.value.accountNo,"onUpdate:modelValue":e[1]||(e[1]=a=>A.value.accountNo=a),placeholder:a.$t("user.t108"),inputBorder:!1,maxlength:"50",clearable:""},null,8,["modelValue","placeholder"])])])),_:1})):v("",!0),"IFSC"===E.value?(t(),u(s,{key:1,class:"ano-form__item",name:"accountNo"},{default:r((()=>[i("div",{class:"ano-form__label"},[i("span",{class:"ano-asterisk"},"*"),c(m(a.$t("user.t109")),1)]),i("div",{class:"ano-form__cnt"},[d(l,{type:"text",modelValue:A.value.accountNo,"onUpdate:modelValue":e[2]||(e[2]=a=>A.value.accountNo=a),placeholder:a.$t("user.t110"),inputBorder:!1,maxlength:"50",clearable:""},null,8,["modelValue","placeholder"])])])),_:1})):v("",!0),"Bank"!==E.value?(t(),u(s,{key:2,class:"ano-form__item"},{default:r((()=>[i("div",{class:"ano-form__label"},m(a.$t("user.t111")),1),i("div",{class:"ano-form__cnt"},[i("div",{class:"ano-imgUpload__wrap",onClick:aa},[A.value.imgUrl?(t(),u(o,{key:0,class:"ano-imgUpload__img",src:p(J).imageLocalUrl+A.value.imgUrl,fit:"scale-down"},null,8,["src"])):(t(),_("div",{key:1,class:"ano-imgUpload__notImg"}))])])])),_:1})):v("",!0),"Bank"===E.value?(t(),u(s,{key:3,class:"ano-form__item"},{default:r((()=>[i("div",{class:"ano-form__label"},[i("span",{class:"ano-asterisk"},"*"),c(m(a.$t("user.t112")),1)]),i("div",{class:"ano-form__cnt"},[d(l,{modelValue:A.value.accountNo,"onUpdate:modelValue":e[3]||(e[3]=a=>A.value.accountNo=a),type:"text",name:"accountNo",placeholder:a.$t("user.t113"),inputBorder:!1,maxlength:"20",onInput:G,clearable:""},null,8,["modelValue","placeholder"])]),p(H)?(t(),_("p",{key:0,class:"account-tips"},m(a.$t("user.t172")),1)):v("",!0)])),_:1})):v("",!0),"Bank"===E.value?(t(),u(s,{key:4,class:"ano-form__item"},{default:r((()=>[i("div",{class:"ano-form__label"},[i("span",{class:"ano-asterisk"},"*"),c(m(a.$t("user.t169")),1)]),i("div",{class:"ano-form__cnt"},[d(l,{modelValue:A.value.bankCode,"onUpdate:modelValue":e[4]||(e[4]=a=>A.value.bankCode=a),type:"text",name:"bankCode",placeholder:a.$t("user.t170"),inputBorder:!1,maxlength:"20",clearable:""},null,8,["modelValue","placeholder"])])])),_:1})):v("",!0),"Bank"===E.value?(t(),u(s,{key:5,class:"ano-form__item",name:"branch"},{default:r((()=>[i("div",{class:"ano-form__label"},m(a.$t("user.t116")),1),i("div",{class:"ano-form__cnt"},[d(l,{modelValue:A.value.branch,"onUpdate:modelValue":e[5]||(e[5]=a=>A.value.branch=a),type:"text",placeholder:a.$t("user.t117"),inputBorder:!1,maxlength:"30",clearable:""},null,8,["modelValue","placeholder"])])])),_:1})):v("",!0),d(s,{class:"ano-form__item ano-form__switch",name:"isDefault"},{default:r((()=>[i("div",{class:"ano-form__label"},m(a.$t("user.t13602")),1),i("div",{class:"ano-form__cnt"},[d(f,{modelValue:A.value.isDefault,"onUpdate:modelValue":e[6]||(e[6]=a=>A.value.isDefault=a),"active-color":"#1c1c1c","inactive-color":"#fff","active-value":1,"inactive-value":0},null,8,["modelValue"])])])),_:1})])),_:1},512),"Bank"===E.value?(t(),_("div",{key:0,class:"payment-warn"},[i("div",{class:"payment-warn__hd"},[i("div",{class:"payment-warn__title"},m(a.$t("user.t118")),1)]),i("div",{class:"payment-warn__bd"},m(a.$t("user.t119")),1)])):v("",!0),i("div",{class:"payment-tips"},m(a.$t("user.t120")),1),d(y,{class:"payment-confirm",color:"#1f1f1f",disabled:!A.value.realName,onClick:la},{default:r((()=>[c(m(a.$t("user.t124")),1)])),_:1},8,["disabled"]),d(k,{show:z.value},null,8,["show"]),d(j,{class:"ano-dialog-password",show:O.value,"onUpdate:show":e[11]||(e[11]=a=>O.value=a),round:"",type:"bottom"},{default:r((()=>[i("div",{class:"dialog-password__content"},[p(F).isJyPassword?(t(),_("div",{key:0,class:"dialog-password__title"},m(a.$t("user.t121")),1)):p(F).isJyPassword||"password1"!=X.value?p(F).isJyPassword||"password2"!=X.value?v("",!0):(t(),_("div",{key:2,class:"dialog-password__title"},m(a.$t("user.t123")),1)):(t(),_("div",{key:1,class:"dialog-password__title"},m(a.$t("user.t122")),1)),d(N,{class:"dialog-password__close",name:"cross",onClick:e[7]||(e[7]=a=>O.value=!1)}),i("div",{class:"dialog-password__address"},[d(C,{value:W.value[X.value],focused:Q.value,onFocus:e[8]||(e[8]=a=>Q.value=!0)},null,8,["value","focused"]),d(I,{modelValue:W.value[X.value],"onUpdate:modelValue":e[9]||(e[9]=a=>W.value[X.value]=a),show:!0,maxlength:6,onBlur:e[10]||(e[10]=a=>O.value=!1),onInput:Y},null,8,["modelValue"])])])])),_:1},8,["show"])])),_:1})}}},[["__scopeId","data-v-149652b2"]]);export{T as default};
