import{q as e,d as t,e as a,w as s,x as l,t as i,k as o,F as d,E as r,l as c,O as n,h as u,n as h,A as m,i as p,P as f,Q as v,R as g,T as y,U as _,u as b,r as x,c as k,K as C,V as $,W as D,f as S,j as I,m as L,X as T,Y as w,G as V,Z as N,p as F,_ as E,s as B,v as R}from"./index-1326579e.js";import{D as j}from"./uni-cloud.es.e0802219.js";import{_ as A}from"./uni-load-more.16e4c6a9.js";import{_ as G,r as O,a as M,b as J}from"./uni-app.es.a60443e8.js";import{_ as P}from"./uni-popup.2c319495.js";import{_ as U}from"./w-loading.4fc13da4.js";import{c as q}from"./utils.6d9bcde1.js";const z=G({name:"uniDataChecklist",mixins:[j.mixinDatacom||{}],emits:["input","update:modelValue","change"],props:{mode:{type:String,default:"default"},multiple:{type:Boolean,default:!1},value:{type:[Array,String,Number],default:()=>""},modelValue:{type:[Array,String,Number],default:()=>""},localdata:{type:Array,default:()=>[]},min:{type:[Number,String],default:""},max:{type:[Number,String],default:""},wrap:{type:Boolean,default:!1},icon:{type:String,default:"left"},selectedColor:{type:String,default:""},selectedTextColor:{type:String,default:""},emptyText:{type:String,default:"_._"},disabled:{type:Boolean,default:!1},map:{type:Object,default:()=>({text:"text",value:"value"})}},watch:{localdata:{handler(e){this.range=e,this.dataList=this.getDataList(this.getSelectedValue(e))},deep:!0},mixinDatacomResData(e){this.range=e,this.dataList=this.getDataList(this.getSelectedValue(e))},value(e){this.dataList=this.getDataList(e)},modelValue(e){this.dataList=this.getDataList(e)}},data:()=>({dataList:[],range:[],contentText:{contentdown:"_._",contentrefresh:"_._",contentnomore:"_._"},isLocal:!0,styles:{selectedColor:"#2979ff",selectedTextColor:"#666"},isTop:0}),computed:{dataValue(){return""===this.value?this.modelValue:(this.modelValue,this.value)}},created(){this.localdata&&0!==this.localdata.length?(this.isLocal=!0,this.range=this.localdata,this.dataList=this.getDataList(this.getSelectedValue(this.range))):this.collection&&(this.isLocal=!1,this.loadData())},methods:{loadData(){this.mixinDatacomGet().then((e=>{this.mixinDatacomResData=e.result.data,0===this.mixinDatacomResData.length?(this.isLocal=!1,this.mixinDatacomErrorMessage=this.emptyText):this.isLocal=!0})).catch((e=>{this.mixinDatacomErrorMessage=e.message}))},getForm(e="uniForms"){let t=this.$parent,a=t.$options.name;for(;a!==e;){if(t=t.$parent,!t)return!1;a=t.$options.name}return t},chagne(e){const t=e.detail.value;let a={value:[],data:[]};if(this.multiple)this.range.forEach((e=>{t.includes(e[this.map.value]+"")&&(a.value.push(e[this.map.value]),a.data.push(e))}));else{const e=this.range.find((e=>e[this.map.value]+""===t));e&&(a={value:e[this.map.value],data:e})}this.$emit("input",a.value),this.$emit("update:modelValue",a.value),this.$emit("change",{detail:a}),this.multiple?this.dataList=this.getDataList(a.value,!0):this.dataList=this.getDataList(a.value)},getDataList(e){let t=JSON.parse(JSON.stringify(this.range)),a=[];return this.multiple&&(Array.isArray(e)||(e=[])),t.forEach(((t,s)=>{if(t.disabled=t.disable||t.disabled||!1,this.multiple)if(e.length>0){let a=e.find((e=>e===t[this.map.value]));t.selected=void 0!==a}else t.selected=!1;else t.selected=e===t[this.map.value];a.push(t)})),this.setRange(a)},setRange(e){let t=e.filter((e=>e.selected)),a=Number(this.min)||0,s=Number(this.max)||"";return e.forEach(((l,i)=>{if(this.multiple){if(t.length<=a){void 0!==t.find((e=>e[this.map.value]===l[this.map.value]))&&(l.disabled=!0)}if(t.length>=s&&""!==s){void 0===t.find((e=>e[this.map.value]===l[this.map.value]))&&(l.disabled=!0)}}this.setStyles(l,i),e[i]=l})),e},setStyles(e,t){e.styleBackgroud=this.setStyleBackgroud(e),e.styleIcon=this.setStyleIcon(e),e.styleIconText=this.setStyleIconText(e),e.styleRightIcon=this.setStyleRightIcon(e)},getSelectedValue(e){if(!this.multiple)return this.dataValue;let t=[];return e.forEach((e=>{e.selected&&t.push(e[this.map.value])})),this.dataValue.length>0?this.dataValue:t},setStyleBackgroud(e){let t={},a=this.selectedColor?this.selectedColor:"#2979ff";this.selectedColor&&("list"!==this.mode&&(t["border-color"]=e.selected?a:"#DCDFE6"),"tag"===this.mode&&(t["background-color"]=e.selected?a:"#f5f5f5"));let s="";for(let l in t)s+=`${l}:${t[l]};`;return s},setStyleIcon(e){let t={},a="";if(this.selectedColor){let a=this.selectedColor?this.selectedColor:"#2979ff";t["background-color"]=e.selected?a:"#fff",t["border-color"]=e.selected?a:"#DCDFE6",!e.selected&&e.disabled&&(t["background-color"]="#F2F6FC",t["border-color"]=e.selected?a:"#DCDFE6")}for(let s in t)a+=`${s}:${t[s]};`;return a},setStyleIconText(e){let t={},a="";if(this.selectedColor){let a=this.selectedColor?this.selectedColor:"#2979ff";"tag"===this.mode?t.color=e.selected?this.selectedTextColor?this.selectedTextColor:"#fff":"#666":t.color=e.selected?this.selectedTextColor?this.selectedTextColor:a:"#666",!e.selected&&e.disabled&&(t.color="#999")}for(let s in t)a+=`${s}:${t[s]};`;return a},setStyleRightIcon(e){let t={},a="";"list"===this.mode&&(t["border-color"]=e.selected?this.styles.selectedColor:"#DCDFE6");for(let s in t)a+=`${s}:${t[s]};`;return a}}},[["render",function(b,x,k,C,$,D){const S=O(e("uni-load-more"),A),I=m,L=p,T=f,w=v,V=g,N=y,F=_;return t(),a(L,{class:"uni-data-checklist",style:n({"margin-top":$.isTop+"px"})},{default:s((()=>[$.isLocal?(t(),o(d,{key:1},[k.multiple?(t(),a(V,{key:0,class:r(["checklist-group",{"is-list":"list"===k.mode||k.wrap}]),onChange:D.chagne},{default:s((()=>[(t(!0),o(d,null,c($.dataList,((e,o)=>(t(),a(w,{class:r(["checklist-box",["is--"+k.mode,e.selected?"is-checked":"",k.disabled||e.disabled?"is-disable":"",0!==o&&"list"===k.mode?"is-list-border":""]]),style:n(e.styleBackgroud),key:o},{default:s((()=>[u(T,{class:"hidden",hidden:"",disabled:k.disabled||!!e.disabled,value:e[k.map.value]+"",checked:e.selected},null,8,["disabled","value","checked"]),"tag"!==k.mode&&"list"!==k.mode||"list"===k.mode&&"left"===k.icon?(t(),a(L,{key:0,class:"checkbox__inner",style:n(e.styleIcon)},{default:s((()=>[u(L,{class:"checkbox__inner-icon"})])),_:2},1032,["style"])):h("",!0),u(L,{class:r(["checklist-content",{"list-content":"list"===k.mode&&"left"===k.icon}])},{default:s((()=>[u(I,{class:"checklist-text",style:n(e.styleIconText)},{default:s((()=>[l(i(e[k.map.text]),1)])),_:2},1032,["style"]),"list"===k.mode&&"right"===k.icon?(t(),a(L,{key:0,class:"checkobx__list",style:n(e.styleBackgroud)},null,8,["style"])):h("",!0)])),_:2},1032,["class"])])),_:2},1032,["class","style"])))),128))])),_:1},8,["class","onChange"])):(t(),a(F,{key:1,class:r(["checklist-group",{"is-list":"list"===k.mode,"is-wrap":k.wrap}]),onChange:D.chagne},{default:s((()=>[(t(!0),o(d,null,c($.dataList,((e,o)=>(t(),a(w,{class:r(["checklist-box",["is--"+k.mode,e.selected?"is-checked":"",k.disabled||e.disabled?"is-disable":"",0!==o&&"list"===k.mode?"is-list-border":""]]),style:n(e.styleBackgroud),key:o},{default:s((()=>[u(N,{class:"hidden",hidden:"",disabled:k.disabled||e.disabled,value:e[k.map.value]+"",checked:e.selected},null,8,["disabled","value","checked"]),"tag"!==k.mode&&"list"!==k.mode||"list"===k.mode&&"left"===k.icon?(t(),a(L,{key:0,class:"radio__inner",style:n(e.styleBackgroud)},{default:s((()=>[u(L,{class:"radio__inner-icon",style:n(e.styleIcon)},null,8,["style"])])),_:2},1032,["style"])):h("",!0),u(L,{class:r(["checklist-content",{"list-content":"list"===k.mode&&"left"===k.icon}])},{default:s((()=>[u(I,{class:"checklist-text",style:n(e.styleIconText)},{default:s((()=>[l(i(e[k.map.text]),1)])),_:2},1032,["style"]),"list"===k.mode&&"right"===k.icon?(t(),a(L,{key:0,style:n(e.styleRightIcon),class:"checkobx__list"},null,8,["style"])):h("",!0)])),_:2},1032,["class"])])),_:2},1032,["class","style"])))),128))])),_:1},8,["class","onChange"]))],64)):(t(),a(L,{key:0,class:"uni-data-loading"},{default:s((()=>[b.mixinDatacomErrorMessage?(t(),a(I,{key:1},{default:s((()=>[l(i(b.mixinDatacomErrorMessage),1)])),_:1})):(t(),a(S,{key:0,status:"loading",iconType:"snow",iconSize:18,"content-text":$.contentText},null,8,["content-text"]))])),_:1}))])),_:1},8,["style"])}],["__scopeId","data-v-ff36aedf"]]),H=G({__name:"purchase",setup(o){const{t:d}=b(),c=S(),n=x(!1),h=k((()=>c.state.userinfo)),f=k((()=>c.state.configInfo)),v=x(!1),g=x(""),y=x(""),_=x({}),j=x({}),A=k((()=>{var e;return new Date((null==(e=j.value.payExpireTime)?void 0:e.replace(/-/g,"/"))||Date())-Date.now()}));k((()=>A.value>=0?(A.value||0)/6e4:0)),M((e=>{console.log(1!=j.orderStatus||A<=0||H.length<=0),g.value=e.id,y.value=e.orderId,n.value=!0,C({goodsId:g.value}).then((e=>{200===e.data.code&&(_.value=e.data.result||{})})).catch((e=>{console.error(e)})).finally((()=>{n.value=!1})),$({orderNumber:y.value}).then((e=>{200===e.data.code&&(j.value=e.data.result||{})})).catch((e=>{console.error(e)})).finally((()=>{n.value=!1,G.value&&D({scrollTop:1e4,duration:100})}))}));const G=k((()=>c.getters.getIsShowGuidance));const H=x([]),K=[{value:1,text:d("trade.t52")}];function Q(){0==H._rawValue.length?(console.log(y.value,"orderId.value"),H.length,v.value=!0,V({title:d("trade.t33"),duration:2e3,icon:"none"})):N({orderNumber:y.value}).then((e=>{F({url:`/pages/trade/pay?id=${g.value}&orderId=${y.value}`})}))}const W=x(null);function X(){W.value.open()}function Y(){W.value.close()}function Z(){ee.value&&(n.value=!0,E({orderNumber:y.value,buyerId:h.value.userId}).then((e=>{if(200!==e.data.code)return void(errorMsg.value=e.data.message);V({title:d("user.t1201"),duration:2e3});let t=setTimeout((()=>{clearTimeout(t),B({url:"/pages/index/index"})}),2e3)})).catch((e=>{V({title:d("message.t1"),duration:2e3})})).finally((()=>{n.value=!1})))}const ee=x(!0),te=()=>{ee.value=!ee.value};return J((()=>{if(c.getters.getIsShowGuidance){let e=c.getters.getGuidanceCurrentStep-1;c.commit("setGuidanceCurrentStep",e<=1?1:e)}})),(o,c)=>{const h=R("van-image"),g=O(e("uni-data-checkbox"),z),y=R("van-button"),b=m,x=p,k=O(e("uni-popup"),P),C=O(e("w-loading"),U);return t(),a(x,{class:"ano-page ano-order"},{default:s((()=>[I("div",{class:"order-section"},[I("div",{class:"order-steps"},[I("div",{class:"step-item step-active"},[I("div",{class:"icon icon-step1"}),I("div",{class:"text"},i(o.$t("trade.t1")),1)]),I("div",{class:"step-arrow1"}),I("div",{class:"step-item"},[I("div",{class:"icon icon-step2"}),I("div",{class:"text"},i(o.$t("trade.t2")),1)]),I("div",{class:"step-arrow1"}),I("div",{class:"step-item"},[I("div",{class:"icon icon-step3"}),I("div",{class:"text"},i(o.$t("trade.t3")),1)])]),I("div",{class:"order-status"},[I("div",{class:"status-time"},[I("div",{class:"t1"},i(o.$t("trade.t1")),1)])])]),I("div",{class:"order-info"},[I("div",{class:"order-info__hd flex-align-center"},[I("div",{class:"order-info__orderNum"},[l(i(o.$t("trade.t7"))+": "+i(j.value.orderNumber)+" ",1),I("div",{class:"icon icon-order",onClick:c[0]||(c[0]=e=>{var t,a;return a=null==(t=j.value)?void 0:t.orderNumber,void q(a,(()=>{V({title:d("user.t29"),icon:"none",duration:2e3})}))})})]),I("div",{class:"order-info__date"},i(j.value.createTime),1)]),I("div",{class:"order-info__bd flex-align-center"},[u(h,{class:"order-info__img",src:L(f).imageLocalUrl+_.value.image,fit:"scale-down"},null,8,["src"]),I("div",{class:"order-info__cnt"},[I("div",{class:"order-info__title flex-align-center"},[I("span",{class:"order-info__t1 ellipsis1"},i(_.value.goodsName),1),I("span",{class:"order-info__t2"},i(o.$t("currencySymbol"))+i(_.value.price||0),1)]),I("div",{class:"order-info__sub flex-align-center"},[I("div",{class:"order-info__t3"},i(o.$t("trade.t8"))+": "+i(_.value.cateName),1),I("div",{class:"order-info__t3"},"x "+i(j.value.totalNum||1),1)]),I("div",{class:"order-info__price"},[I("span",{class:"order-info__symbol"},i(o.$t("currencySymbol")),1),l(i(j.value.totalPrice),1)])])])]),I("div",{class:"order-treaty"},[I("div",{class:"order-treaty__row"},i(o.$t("trade.rule_1")),1),I("div",{class:"order-treaty__row"},i(o.$t("trade.rule_2")),1),I("div",{class:"order-treaty__row"},i(o.$t("trade.rule_3")),1),I("div",{class:"order-treaty__check"},[u(g,{modelValue:H.value,"onUpdate:modelValue":c[1]||(c[1]=e=>H.value=e),localdata:K,multiple:"true","selected-color":"#1f1f1f"},null,8,["modelValue"])]),T(I("div",{style:{color:"red","margin-left":"40rpx"}},i(o.$t("trade.t33")),513),[[w,v.value&&0==H.value.length]])]),I("div",{class:"order-footer"},[u(y,{class:"order-footer__btn",plain:"",color:"#0F0F0F",onClick:X},{default:s((()=>[l(i(o.$t("trade.t10")),1)])),_:1}),u(y,{class:"order-footer__btn",color:"#0F0F0F",onClick:Q},{default:s((()=>[l(i(o.$t("trade.t11")),1)])),_:1})]),u(k,{class:"ano-popup popup-cancleOrder",ref_key:"cancleOrderPopup",ref:W,type:"center","is-mask-click":!1},{default:s((()=>[u(x,{class:"popup-content"},{default:s((()=>[I("div",{class:"popup-header"},[u(b,{class:"t1"},{default:s((()=>[l(i(o.$t("trade.t12")),1)])),_:1})]),I("div",{class:"popup-acticle"},i(o.$t("trade.t13")),1),I("div",{class:"popup-agreement flex-align-center"},[I("div",{class:r(["icon-radio",{"icon-radio__active":ee.value}]),onClick:te},null,2),u(b,{class:"t1"},{default:s((()=>[l(i(o.$t("trade.t15")),1)])),_:1})]),I("div",{class:"popup-error"}),I("div",{class:"popup-handle"},[I("div",{class:"btn btn-cancle",onClick:Y},i(o.$t("trade.t16")),1),I("div",{class:"line"}),I("div",{class:"btn btn-confirm",disabled:!ee.value,onClick:Z},i(o.$t("trade.t17")),9,["disabled"])])])),_:1})])),_:1},512),u(C,{show:n.value},null,8,["show"])])),_:1})}}},[["__scopeId","data-v-fe19cad8"]]);export{H as default};
