import{u as e,r as i,c as s,d as a,e as t,w as o,f as l,i as n,j as u,h as r,m as d,x as c,t as v,n as _,k as f,a8 as m,G as p,v as y,A as g,q as C}from"./index-1326579e.js";import{_ as k}from"./uni-icons.e2da828d.js";import{_ as h,r as F}from"./uni-app.es.a60443e8.js";import{_ as b}from"./uni-easyinput.bcff0311.js";import{_ as $}from"./w-loading.4fc13da4.js";import{g as w,s as x,f as N,u as I}from"./user.2b7a6c52.js";import{c as j,d as U}from"./utils.6d9bcde1.js";const V=h({__name:"userinfo",setup(h){const{t:V}=e(),z=l(),B=i(!1),A=s((()=>z.state.userinfo||{})),L=s((()=>z.state.configInfo)),P=i(!1),q=()=>{P.value=!P.value};Q();const D=i({inviter:"",userName:"",avatar:""}),G=i(!1),J=i(!1),T=()=>{G.value=!G.value},E=()=>{J.value=!J.value},H=i(!1),K=i("");let M="";function O(e){m({count:1,sourceType:["album"],success(e){M=e.tempFiles[0],M.size>1048576?p({title:V("user.t30"),icon:"none",duration:2e3}):(K.value=M.path,H.value=!0)},fail(e){console.error(e),p({title:e,icon:"none",duration:2e3})}})}function Q(){w({userId:A.value.userId}).then((e=>{var i,s,a,t;200===e.data.code&&(D.value={userName:null==(i=e.data.result)?void 0:i.userName,avatar:null==(s=e.data.result)?void 0:s.avatar,inviterCode:null==(a=e.data.result)?void 0:a.inviterCode},K.value=L.value.imageLocalUrl+(null==(t=e.data.result)?void 0:t.avatar),z.commit("setUserinfo",e.data.result))}))}function R(e){if("inviterCode"===e)return D.value.inviterCode?D.value.inviterCode&&D.value.inviterCode==A.value.promotionCode?void p({title:V("user.t3305"),icon:"none",duration:2e3}):(B.value=!0,void x({inviterCode:D.value.inviterCode,userId:A.value.userId}).then((e=>{200===e.data.code?(G.value=!1,z.commit("setUserinfo",{...A.value,inviterCode:D.value.inviterCode}),p({title:V("user.t33"),icon:"none",duration:2e3})):p({title:e.data.message,icon:"none",duration:2e3})})).catch((e=>{console.error(e),p({title:V("message.t1"),icon:"none",duration:2e3})})).finally((()=>{B.value=!1}))):void p({title:V("user.t3304"),icon:"none",duration:2e3});"userName"!==e||D.value.userName?(B.value=!0,N({...D.value,userId:A.value.userId}).then((i=>{200===i.data.code?("inviterCode"===e&&(G.value=!1),"userName"===e&&(J.value=!1),"avatar"===e&&(H.value=!1),Q(),p({title:V("user.t33"),icon:"none",duration:2e3})):p({title:i.data.message,icon:"none",duration:2e3})})).catch((e=>{console.error(e),p({title:V("message.t1"),icon:"none",duration:2e3})})).finally((()=>{B.value=!1}))):p({title:V("user.t32"),icon:"none",duration:2e3})}function S(e){B.value=!0,(e=>{if(!(e.size>1048576))return H.value=!0,I({name:"file",filePath:e.path,formData:{biz:"userinfo"}});p({title:V("user.t30"),icon:"none",duration:2e3})})(M).then((i=>{if(200===i.code)return D.value.avatar=i.result,R(e);p({title:i.message,icon:"none",duration:2e3})})).catch((e=>{console.error(e),p({title:V("user.t31"),icon:"none",duration:2e3})})).finally((()=>{B.value=!1}))}return(e,i)=>{const s=y("van-image"),l=g,m=F(C("uni-icons"),k),h=F(C("uni-easyinput"),b),w=y("van-button"),x=F(C("w-loading"),$),N=n;return a(),t(N,{class:"ano-page ano-userinfo"},{default:o((()=>[u("div",{class:"userinfo-head"},[r(s,{class:"userinfo-head__img",fit:"contain",src:d(L).imageLocalUrl+d(A).avatar,round:""},null,8,["src"])]),u("div",{class:"userinfo-log"},[u("div",{class:"userinfo-log__row"},[r(l,{class:"userinfo-log__label"},{default:o((()=>[c(v(e.$t("user.t20")),1)])),_:1}),d(A).mobile&&!P.value?(a(),t(l,{key:0,class:"userinfo-log__cnt"},{default:o((()=>[c(v(d(U)(d(A).mobile).phone()),1)])),_:1})):_("",!0),d(A).mobile&&P.value?(a(),t(l,{key:1,class:"userinfo-log__cnt"},{default:o((()=>[c(v(d(A).mobile),1)])),_:1})):_("",!0),d(A).email?(a(),t(l,{key:2,class:"userinfo-log__cnt"},{default:o((()=>[c(v(d(A).email),1)])),_:1})):_("",!0),P.value?(a(),t(m,{key:3,type:"eye-filled",class:"userinfo-log__icon-eye",onClick:q})):(a(),t(m,{key:4,type:"eye-slash-filled",class:"userinfo-log__icon-eye",onClick:q}))]),u("div",{class:"userinfo-log__row"},[r(l,{class:"userinfo-log__label"},{default:o((()=>[c(v(e.$t("user.uid")),1)])),_:1}),r(l,{class:"userinfo-log__cnt"},{default:o((()=>[c(v(d(A).userId),1)])),_:1}),u("div",{class:"userinfo-log__icon-card",onClick:i[0]||(i[0]=e=>{return i=d(A).userId,void j(i,(()=>{p({title:V("user.t29"),icon:"none",duration:2e3})}));var i})})])]),u("div",{class:"userinfo-edit"},[u("div",{class:"userinfo-edit__row"},[u("div",{class:"userinfo-edit__icon userinfo-edit__icon-inviter"}),u("div",{class:"userinfo-edit__cnt"},[u("div",{class:"userinfo-edit__t1"},v(e.$t("user.t3301")),1),d(A).inviterCode?(a(),f("div",{key:0,class:"userinfo-edit__t2"},v(e.$t("user.t3302")),1)):(a(),f("div",{key:1,class:"userinfo-edit__t2"},v(e.$t("user.t3303")),1)),u("div",{class:"userinfo-edit__field"},[G.value?(a(),t(h,{key:1,class:"userinfo-edit__text",maxlength:"20",type:"text",focus:!0,inputBorder:!1,clearable:"",modelValue:D.value.inviterCode,"onUpdate:modelValue":i[1]||(i[1]=e=>D.value.inviterCode=e)},null,8,["modelValue"])):(a(),f("div",{key:0,class:"userinfo-edit__text"},v(D.value.inviterCode),1)),G.value||d(A).inviterCode?_("",!0):(a(),t(w,{key:2,class:"userinfo-edit__btn",plain:"",color:"#1F1F1F",onClick:T},{default:o((()=>[c(v(e.$t("user.t24")),1)])),_:1})),G.value?(a(),t(w,{key:3,class:"userinfo-edit__btn",plain:"",color:"#1F1F1F",onClick:i[2]||(i[2]=e=>R("inviterCode"))},{default:o((()=>[c(v(e.$t("user.t25")),1)])),_:1})):_("",!0)])])]),u("div",{class:"userinfo-edit__line"}),u("div",{class:"userinfo-edit__row"},[u("div",{class:"userinfo-edit__icon userinfo-edit__icon-user"}),u("div",{class:"userinfo-edit__cnt"},[u("div",{class:"userinfo-edit__t1"},v(e.$t("user.t22")),1),u("div",{class:"userinfo-edit__t2"},v(e.$t("user.t23")),1),u("div",{class:"userinfo-edit__field"},[J.value?(a(),t(h,{key:1,class:"userinfo-edit__text",maxlength:"20",type:"text",focus:!0,inputBorder:!1,clearable:"",modelValue:D.value.userName,"onUpdate:modelValue":i[3]||(i[3]=e=>D.value.userName=e)},null,8,["modelValue"])):(a(),f("div",{key:0,class:"userinfo-edit__text"},v(D.value.userName),1)),J.value?(a(),t(w,{key:3,class:"userinfo-edit__btn",plain:"",color:"#1F1F1F",onClick:i[4]||(i[4]=e=>R("userName"))},{default:o((()=>[c(v(e.$t("user.t25")),1)])),_:1})):(a(),t(w,{key:2,class:"userinfo-edit__btn",plain:"",color:"#1F1F1F",onClick:E},{default:o((()=>[c(v(e.$t("user.t24")),1)])),_:1}))])])]),u("div",{class:"userinfo-edit__line"}),u("div",{class:"userinfo-edit__row"},[u("div",{class:"userinfo-edit__icon userinfo-edit__icon-head"}),u("div",{class:"userinfo-edit__cnt"},[u("div",{class:"userinfo-edit__t1"},v(e.$t("user.t26")),1),u("div",{class:"userinfo-edit__t2"},v(e.$t("user.t27")),1),u("div",{class:"userinfo-edit__field"},[r(s,{class:"userinfo-edit__img",fit:"scale-down",src:K.value,round:"",onClick:O},null,8,["src"]),H.value?(a(),t(w,{key:1,class:"userinfo-edit__btn",plain:"",color:"#1F1F1F",onClick:i[5]||(i[5]=e=>S("avatar"))},{default:o((()=>[c(v(e.$t("user.t28")),1)])),_:1})):(a(),t(w,{key:0,class:"userinfo-edit__btn",plain:"",color:"#1F1F1F",onClick:O},{default:o((()=>[c(v(e.$t("user.t24")),1)])),_:1}))])])])]),r(x,{show:B.value},null,8,["show"])])),_:1})}}},[["__scopeId","data-v-c3ab7f20"]]);export{V as default};
