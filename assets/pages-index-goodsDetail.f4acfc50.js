import{u as e,r as a,c as s,J as l,K as o,d as t,e as i,w as r,f as u,i as d,h as n,j as c,k as v,l as m,F as _,t as y,n as g,x as h,E as p,m as f,p as b,L as w,G as I,q as $,v as k,S as C,M as S,N,y as j}from"./index-1326579e.js";import{_ as x}from"./uni-nav-bar.e0329405.js";import{_ as D,a as L,b as G,r as T}from"./uni-app.es.a60443e8.js";import{_ as B}from"./uni-icons.e2da828d.js";import{_ as z}from"./w-loading.4fc13da4.js";const P=D({__name:"goodsDetail",setup(D){const{t:P}=e(),A=u(),E=a(!1),M=s((()=>A.state.userinfo)),U=s((()=>A.state.configInfo)),q=()=>{b({url:"/pages/invite/invite"})},F=()=>{history.go(-1)};a({goodsName:""}),a([{label:P("home.t14"),value:0},{label:P("home.t15"),value:1},{label:P("home.t16"),value:2}]),a(0),a([]);const J=a(""),K=a({}),R=a({});s((()=>A.state.service));const H=s((()=>{var e;return new Date((null==(e=K.value.payExpireTime)?void 0:e.replace(/-/g,"/"))||Date())-Date.now()}));s((()=>H.value>=0?(H.value||0)/6e4:0)),L((e=>{J.value=e.id,E.value=!0,(l({ids:J.value,pageNo:1,pageSize:4}).then((e=>{var a;200===e.data.code&&(R.value=(null==(a=e.data)?void 0:a.result)||{})})).catch((e=>{})),o({goodsId:J.value,userId:M.value.userId}).then((e=>{var a;200===e.data.code&&(K.value=(null==(a=e.data)?void 0:a.result)||{})})).catch((e=>{}))).finally((()=>{E.value=!1}))}));const O=a(!1);s((()=>{var e,a,s;return O.value?(null==(e=K.value)?void 0:e.attrList)||[]:null==(s=null==(a=K.value)?void 0:a.attrList)?void 0:s.slice(0,5)}));const Q=()=>{var e;(null==(e=null==A?void 0:A.state)?void 0:e.accessToken)?(E.value=!0,w({buyerAddress:"",buyerId:M.value.userId,buyerRealName:M.value.userName,goodsId:K.value.id,sellerId:K.value.ownerId,totalNum:1,totalPostage:"",totalPrice:1*K.value.price}).then((e=>{200===e.data.code?b({url:`/pages/trade/purchase?id=${J.value}&orderId=${e.data.result}`}):I({title:e.data.message,icon:"none",duration:2e3})})).catch((e=>{console.error(e,"--getGoodsBuyList--"),I({title:P("message.t1"),icon:"none",duration:2e3})})).finally((()=>{E.value=!1}))):b({url:"/pages/login/login"})},V=()=>{if(!M.value.userId)return void b({url:"/pages/login/login"});let e;e=K.value.isCollection?S:N,e({goodsId:K.value.id,userId:M.value.userId}).then((e=>{200===e.data.code?(K.value.isCollection=1==K.value.isCollection?0:1,I({title:1==K.value.isCollection?P("home.t17"):P("home.t18"),icon:"none",duration:2e3})):I({title:e.data.message,icon:"none",duration:2e3})})).catch((e=>{I({title:P("message.t1"),icon:"none",duration:2e3})}))};function W(e){if(!e)return P("home.t20");let a=new Date(e.replace(/-/g,"/")).getTime(),s=(new Date).getTime()-a;return s<6e4?P("home.t20"):s<36e5&&s>=6e4?`${parseInt(s/6e4)}${P("home.t21")}`:s<864e5&&s>=36e5?`${parseInt(s/36e5)}${P("home.t22")}`:`${parseInt(s/864e5)}${P("home.t23")}`}return G((()=>{if(A.getters.getIsShowGuidance){let e=A.getters.getGuidanceCurrentStep-1;A.commit("setGuidanceCurrentStep",e<=1?1:e)}})),(e,a)=>{const s=T($("uni-nav-bar"),x),l=k("van-image"),o=j,u=C,b=T($("uni-icons"),B),w=k("van-button"),I=T($("w-loading"),z),S=d;return t(),i(S,{class:"ano-page ano-goods"},{default:r((()=>{var a,d,$,k,C;return[n(s,{class:"ano-statusBar","background-color":"#fff",statusBar:!0,border:!1,height:"0","status-bar":""}),c("div",{class:"goods-header"},[c("div",{class:"goods-header__cell icon-left",onClick:F}),c("div",{class:"goods-header__search"}),c("div",{class:"goods-header__cell icon-share",onClick:q})]),c("div",{class:"goods-summary__wrap"},[c("div",{class:"summary-banner"},[n(u,{class:"summary-banner__swipe",autoplay:!0,"indicator-dots":!0},{default:r((()=>{var e;return[(t(!0),v(_,null,m(null==(e=K.value.sliderImage)?void 0:e.split(","),(e=>(t(),i(o,{key:e},{default:r((()=>[n(l,{src:f(U).imageLocalUrl+e,fit:"scale-down"},null,8,["src"])])),_:2},1024)))),128))]})),_:1})]),5==K.value.isShow?(t(),v("div",{key:0,class:"summary-section summary-tips"},y(e.$t("home.t34")),1)):g("",!0),c("div",{class:"summary-section summary-info"},[c("div",{class:"summary-info__price"},[c("div",{class:"summary-info__t1"},[c("span",{class:"summary-info__symbol"},y(e.$t("currencySymbol")),1),h(y(K.value.price),1)]),K.value.rate&&0!=K.value.rate?(t(),v("div",{key:0,class:"goods-price-rate"},[n(b,{type:"arrow-up",color:"#fff",size:"12"}),h(y(K.value.rate)+"% ",1)])):g("",!0)]),c("div",{class:"summary-info__t3"},y(K.value.goodsName),1)]),c("div",{class:"summary-section summary-history"},[c("div",{class:"summary-section__hd"},[c("div",{class:"summary-section__t1"},y(e.$t("home.t4"))+"("+y(null==(a=R.value)?void 0:a.total)+"+)",1)]),(null==($=null==(d=R.value)?void 0:d.records)?void 0:$.length)?(t(),v("div",{key:0,class:"summary-history__wrap"},[(t(!0),v(_,null,m(null==(k=R.value)?void 0:k.records,(a=>(t(),v("div",{class:"summary-history__item",key:a.id},[c("div",{class:"summary-history__cell"},[c("div",{class:"summary-history__avatars"}),c("div",{class:"summary-history__t1 ellipsis1"},y(a.buyerMobile)+" "+y(e.$t("home.t6")),1)]),c("div",{class:"summary-history__cell"},[c("div",{class:"summary-history__t1"},y(e.$t("currencySymbol"))+y(a.totalPrice),1)]),c("div",{class:"summary-history__cell"},[c("div",{class:"summary-history__t3"},y(W(a.createTime)),1)])])))),128))])):(t(),v("div",{key:1,class:"summary-history__list summary-history__empty"},y(e.$t("home.t7")),1))]),c("div",{class:"summary-detail"},[(t(!0),v(_,null,m(null==(C=K.value.details)?void 0:C.split(","),(e=>(t(),i(l,{key:e,src:f(U).imageLocalUrl+e,fit:"scale-down"},null,8,["src"])))),128))])]),c("div",{class:"goods-footer"},[c("div",{class:"goods-footer__box"}),c("div",{class:"goods-footer__wrap"},[c("div",{class:"cell_box"},[c("div",{class:"goods-footer__cell",onClick:V},[c("div",{class:p(["goods-footer__icon icon-collect",{"icon-collect2":K.value.isCollection}])},null,2),c("div",{class:"goods-footer__t1"},y(e.$t("home.t11")),1)])]),n(w,{class:"goods-footer__buy",color:"#202020",disabled:K.value.ownerId==f(M).userId||4==K.value.isShow||5==K.value.isShow,onClick:Q},{default:r((()=>[h(y(e.$t("home.t24")),1)])),_:1},8,["disabled"])])]),n(I,{show:E.value},null,8,["show"])]})),_:1})}}},[["__scopeId","data-v-6de4d39f"]]);export{P as default};
