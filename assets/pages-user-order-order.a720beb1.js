import{u as e,f as a,r as l,c as r,v as o,q as s,d as t,k as u,j as d,n,t as i,h as c,m as v,x as p,e as m,w as f,F as _,p as b,G as y,a2 as g,o as w,a5 as h,a6 as T,i as N,l as S,A as k}from"./index-1326579e.js";import{_ as U}from"./uni-nav-bar.e0329405.js";import{_ as x,r as I,o as j,d as $}from"./uni-app.es.a60443e8.js";import{_ as F,a as O}from"./y-tabs.d2665ce6.js";import{_ as R}from"./uni-load-more.16e4c6a9.js";import{_ as C}from"./w-loading.4fc13da4.js";import{_ as V}from"./uni-easyinput.bcff0311.js";import{_ as z}from"./uni-file-picker.79ded5f4.js";import{_ as D}from"./ano-popup.0d0d982a.js";import{c as B}from"./utils.6d9bcde1.js";import{u as P}from"./order.a11815e6.js";import{r as A,o as G,u as L,a as M,c as q}from"./user.2b7a6c52.js";import"./uni-icons.e2da828d.js";import"./uni-cloud.es.e0802219.js";const E=x({__name:"order-item",props:{row:{type:Object,default:()=>{}},orderType:{default:0}},emits:["reload"],setup(w,{emit:h}){const T=w,{t:N}=e(),S=a(),k=l(!1),U=r((()=>S.state.userinfo)),x=r((()=>S.state.configInfo)),j=P(N),$=e=>{S.commit("setOrderTabs",{orderType:0,subTab:0}),b({url:`/pages/user/order/detail?orderId=${e.orderNumber}&id=${e.goodsId}&orderType=${T.orderType}`})};const F=l(!1),O=l({reason:"",imgUrl:[]});let R=[];const C=e=>{let a=e.tempFiles[0];R.push(a)},M=e=>{let a;R.forEach(((l,r)=>{l.uuid==e.tempFile.uuid&&(a=r)})),R.splice(a,1)};let q={};const E=l(1),H=l(!1),J=()=>{console.log("3"),H.value=!0,Promise.all(R.filter((e=>!!e.uuid)).map((e=>L({name:"file",filePath:e.path,formData:{biz:"pay"}})))).then((e=>{G({orderNumber:q.orderNumber,reason:O.value.reason,cptImg:e.map((e=>e.result)).join(","),userId:U.value.userId}).then((e=>{200===e.data.code?(y({title:N("user.t8202"),icon:"success",duration:2e3}),h("reload"),E.value++,F.value=!1):y({title:e.data.message,icon:"none",duration:2e3})})).catch((e=>{y({title:N("message.t1"),icon:"none",duration:2e3})})).finally((()=>{H.value=!1}))})).catch((e=>{y({title:N("user.t133"),icon:"none",duration:2e3})})).finally((()=>{}))};return(e,a)=>{var l,r,T,S,R,P,G,L,Q,K,W;const X=o("van-image"),Y=o("van-button"),Z=I(s("uni-easyinput"),V),ee=I(s("uni-file-picker"),z),ae=I(s("ano-popup"),D);return t(),u(_,null,[d("div",{class:"order-info"},[d("div",{class:"order-info__hd flex-align-center"},[1!=w.orderType||1!=w.row.paidSellerUnReadNum&&1!=w.row.appealSellerUnReadNum&&1!=w.row.completedSellerUnReadNum?n("",!0):(t(),u("div",{key:0,class:"order-info__dot"})),d("div",{class:"order-info__orderNum"},i(e.$t("user.t76"))+": "+i(w.row.orderNumber),1),d("div",{class:"order-info__icon-card",onClick:a[0]||(a[0]=e=>{return a=w.row.orderNumber,void B(a,(()=>{y({title:N("user.t29"),icon:"none",duration:2e3})}));var a})}),d("div",{class:"order-info__date"},i(w.row.createTime),1)]),d("div",{class:"order-info__bd flex-align-center"},[c(X,{class:"order-info__img",src:v(x).imageLocalUrl+(null==(r=null==(l=w.row)?void 0:l.goodsDetail)?void 0:r.image),fit:"scale-down",onClick:a[1]||(a[1]=e=>$(w.row))},null,8,["src"]),d("div",{class:"order-info__cnt"},[d("div",{class:"order-info__title flex-align-center",onClick:a[2]||(a[2]=e=>$(w.row))},[d("span",{class:"order-info__t1 ellipsis1"},i(null==(S=null==(T=w.row)?void 0:T.goodsDetail)?void 0:S.goodsName),1),d("span",{class:"order-info__t2"},i(e.$t("currencySymbol"))+i((null==(P=null==(R=w.row)?void 0:R.goodsDetail)?void 0:P.price)||0),1)]),d("div",{class:"order-info__sub flex-align-center",onClick:a[3]||(a[3]=e=>$(w.row))},[d("div",{class:"order-info__t3"},i(e.$t("user.t77"))+": "+i(null==(L=null==(G=w.row)?void 0:G.goodsDetail)?void 0:L.cateName),1),d("div",{class:"order-info__t3"},"x "+i((null==(K=null==(Q=w.row)?void 0:Q.goodsDetail)?void 0:K.totalNum)||1),1)]),d("div",{class:"order-info__handle"},[d("div",{class:"order-info__price"},[d("span",{class:"order-info__symbol"},i(e.$t("currencySymbol")),1),p(i(null==(W=w.row)?void 0:W.totalPrice),1)]),0==w.orderType&&1==w.row.orderStatus?(t(),m(Y,{key:0,class:"order-info__btn",color:"#1F1F1F",plain:"",onClick:a[4]||(a[4]=e=>{return a=w.row,void b({url:`/pages/trade/pay?orderId=${a.orderNumber}&id=${a.goodsId}`});var a})},{default:f((()=>[p(i(e.$t("user.t78")),1)])),_:1})):1==w.orderType&&2==w.row.orderStatus?(t(),m(Y,{key:1,class:"order-info__btn",color:"#1F1F1F",plain:"",onClick:a[5]||(a[5]=e=>{return a=w.row,void g({title:N("user.t80"),content:N("user.t81"),success:function(e){e.confirm&&(k.value=!0,A({orderNumber:a.orderNumber,sellerId:U.value.userId}).then((e=>{200===e.data.code?(y({title:N("user.t82"),icon:"success",duration:2e3}),h("reload")):y({title:e.data.message,icon:"none",duration:2e3})})).catch((e=>{y({title:N("message.t1"),icon:"none",duration:2e3})})).finally((()=>{k.value=!1})))}});var a})},{default:f((()=>[p(i(e.$t("user.t79")),1)])),_:1})):(t(),u("div",{key:2,class:"order-info__btn"},i(v(j).getOrderStatus(w.row.orderStatus).statusText),1)),2==w.row.orderStatus?(t(),m(Y,{key:3,class:"order-info__btn",color:"#1F1F1F",plain:"",onClick:a[6]||(a[6]=e=>{return a=w.row,console.log("2"),F.value=!0,void(q=a);var a})},{default:f((()=>[p(i(e.$t("user.t8201")),1)])),_:1})):n("",!0)])])])]),(t(),m(ae,{class:"ano-popup popup-sue",show:F.value,"onUpdate:show":a[9]||(a[9]=e=>F.value=e),key:E.value,round:""},{default:f((()=>[d("div",{class:"popup-sue__content"},[d("div",{class:"popup-sue__close",onClick:a[7]||(a[7]=e=>F.value=!1)}),d("div",{class:"popup-sue__row"},[d("div",{class:"popup-sue__cnt"},[c(Z,{class:"popup-sue__textarea",modelValue:O.value.reason,"onUpdate:modelValue":a[8]||(a[8]=e=>O.value.reason=e),autosize:"",type:"textarea",maxlength:"100",placeholder:e.$t("user.t8203")},null,8,["modelValue","placeholder"])])]),d("div",{class:"popup-sue__row"},[d("div",{class:"popup-sue__label"},i(e.$t("user.t8204")),1),d("div",{class:"popup-sue__cnt"},[c(ee,{"auto-upload":!1,sourceType:"album",limit:"3","file-mediatype":"image",onSelect:C,onDelete:M})])]),c(Y,{class:"popup-sue__confirm",color:"#1f1f1f",disabled:!O.value.reason,loading:H.value,"loading-text":e.$t("user.t8205"),onClick:J},{default:f((()=>[p(i(e.$t("user.t8205")),1)])),_:1},8,["disabled","loading","loading-text"])])])),_:1},8,["show"]))],64)}}},[["__scopeId","data-v-a30f6fc9"]]),H=x({__name:"order",setup(o){const{t:b}=e(),y=a(),g=l(!1),x=r((()=>y.state.userinfo)),V=r((()=>y.state.orderUnread||{})),z=r((()=>V.value.appealSellerUnReadNum+V.value.completedSellerUnReadNum+V.value.paidSellerUnReadNum)),D=l([{id:0,label:b("user.t73")},{id:1,label:b("user.t74")}]),B=l(0),P=()=>{var e;1==B.value?L.value=1:L.value=0,y.commit("setOrderTabs",{orderType:L.value,subTab:B.value}),Z.value=X[0].value,K.value.records=[],null==(e=G.value)||e.reset((()=>{var e;null==(e=G.value)||e.resize()})),g.value=!0,W(J).finally((()=>{g.value=!1}))},A=r((()=>2==B.value?[{id:1,label:b("user.t1203"),status:4},{id:2,label:b("user.t1204"),status:5}]:[{id:1,label:b("user.t9"),status:1},{id:2,label:b("user.t10"),status:2},{id:3,label:b("user.t11"),status:7},{id:3,label:b("user.t1201"),status:0},{id:4,label:b("user.t12"),status:"3,6"}])),G=l(null),L=l(0),H=r((()=>A.value[L.value].status)),J={pageSize:10,pageNo:1},Q=()=>{y.commit("setOrderTabs",{orderType:L.value,subTab:B.value}),Z.value=X[0].value,K.value.records=[],g.value=!0,W(J).finally((()=>{g.value=!1}))};w((()=>{})),j((()=>{y.state.orderTabs.orderType&&(B.value=+y.state.orderTabs.orderType),y.state.orderTabs.subTab&&(L.value=+y.state.orderTabs.subTab),g.value||(g.value=!0,W(J).finally((()=>{g.value=!1})))}));const K=l({records:[]});function W(e){return M({userId:y.state.userinfo.userId}).then((e=>{var a,l,r;if(200!==e.data.code)return;let o={appealSellerUnReadNum:(null==(a=e.data.result)?void 0:a.appealSellerUnReadNum)||0,completedSellerUnReadNum:(null==(l=e.data.result)?void 0:l.completedSellerUnReadNum)||0,paidSellerUnReadNum:(null==(r=e.data.result)?void 0:r.paidSellerUnReadNum)||0};y.commit("setOrderUnread",o),z.value>0?h({index:2}):T({index:2})})),console.log({orderStatus:H.value}),q({...e,sellerId:0==B.value?null:x.value.userId,buyerId:0!=B.value?null:x.value.userId,orderStatus:H.value}).then((a=>{var l,r,o,s;200===a.data.code&&(1==e.pageNo?K.value=null==(l=a.data)?void 0:l.result:K.value={...null==(r=a.data)?void 0:r.result,records:K.value.records.concat((null==(s=null==(o=a.data)?void 0:o.result)?void 0:s.records)||[])})})).catch((e=>{}))}const X=[{value:"more"},{value:"loading"},{value:"noMore"}],Y=l({contentdown:b("message.t2"),contentrefresh:b("message.t3"),contentnomore:b("message.t4")}),Z=r((()=>{var e,a,l;return g.value?X[1].value:(null==(e=K.value)?void 0:e.total)>(null==(l=null==(a=K.value)?void 0:a.records)?void 0:l.length)?X[0].value:X[2].value}));$((()=>{var e;K.value.total>(null==(e=K.value)?void 0:e.records.length)&&W({pageSize:J.pageSize,pageNo:+K.value.current+1})}));const ee=()=>{W(J)};return(e,a)=>{const l=I(s("uni-nav-bar"),U),r=I(s("y-tab"),F),o=I(s("y-tabs"),O),b=k,y=I(s("uni-load-more"),R),w=I(s("w-loading"),C),h=N;return t(),m(h,{class:"ano-page ano-myOrder"},{default:f((()=>[c(l,{class:"ano-statusBar","background-color":"#fff",statusBar:!0,border:!1,height:"0"}),c(o,{class:"myOrder-navTabs",modelValue:B.value,"onUpdate:modelValue":a[0]||(a[0]=e=>B.value=e),type:"card",color:"#1f1f1f",ellipsis:!1,onChange:P},{default:f((()=>[(t(!0),u(_,null,S(D.value,(e=>(t(),m(r,{class:"myOrder-navTabs_tab",dot:1==e.id&&v(z)>0,title:e.label},null,8,["dot","title"])))),256))])),_:1},8,["modelValue"]),c(o,{class:"myOrder-tabs",ref_key:"subTabs",ref:G,modelValue:L.value,"onUpdate:modelValue":a[1]||(a[1]=e=>L.value=e),color:"#1f1f1f","line-width":"10%","title-active-color":"#1F1F1F","title-inactive-color":"#91999B",onChange:Q},{default:f((()=>[(t(!0),u(_,null,S(v(A),(a=>{return t(),m(r,{class:"myOrder-tabs_tab",dot:(l=a,0!=B.value&&(0==l.id&&z.value>0||2==l.id&&V.value.paidSellerUnReadNum>0||4==l.id&&V.value.completedSellerUnReadNum>0||void 0)),title:a.label},{default:f((()=>{var a,l,r,o;return[d("div",{class:"myOrder-orders-section"},[(null==(a=K.value)?void 0:a.records.length)?(t(),u("div",{key:0,class:"myOrder-orders"},[(t(!0),u(_,null,S(null==(l=K.value)?void 0:l.records,(e=>(t(),u("div",{class:"myOrder-orders-row",key:e.id},[(t(),m(E,{row:e,orderType:B.value,key:e.id,onReload:ee},null,8,["row","orderType"]))])))),128))])):n("",!0),(null==(r=K.value)?void 0:r.records.length)||g.value?n("",!0):(t(),u("div",{key:1,class:"ano-empty"},[d("div",{class:"ano-empty__img"}),c(b,{class:"ano-empty__text"},{default:f((()=>[p(i(e.$t("user.t58")),1)])),_:1})])),(null==(o=K.value)?void 0:o.records.length)?(t(),m(y,{key:2,status:v(Z),"content-text":Y.value},null,8,["status","content-text"])):n("",!0)])]})),_:2},1032,["dot","title"]);var l})),256))])),_:1},8,["modelValue"]),c(w,{show:g.value},null,8,["show"])])),_:1})}}},[["__scopeId","data-v-04abd2f4"]]);export{H as default};
