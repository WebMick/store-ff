import{u as e,r as a,c as l,d as t,e as s,w as o,f as u,i as n,h as i,j as d,x as c,t as r,m as v,n as m,z as g,G as f,av as p,q as h,A as _,I as y,v as b,B as k}from"./index-1326579e.js";import{_ as T}from"./uni-nav-bar.e0329405.js";import{_ as C,a as I,r as w}from"./uni-app.es.a60443e8.js";import{_ as $}from"./uni-icons.e2da828d.js";import{_ as x}from"./w-loading.4fc13da4.js";import{a as j,l as A,r as B,b as M}from"./login.d846595a.js";const U=C({__name:"code",setup(C){const{t:U}=e(),V=()=>{history.go(-1)},z=a(0),F=a({code:""});I((e=>{z.value=e.codeType}));const q=a(1),E=a(!1),G={timeId:0,maxTime:60,start(){D.value=this.maxTime,this.timeId=setInterval((()=>{D.value>=0?D.value--:this.stop()}),1e3)},stop(){D.value=0,clearInterval(this.timeId)}},D=a(0),H=u(),J=l((()=>({...H.state.loginInfo,areaCode:H.state.areaCode})));function K(){var e,a,l;E.value=!0,j({...J.value,codeType:J.value.codeType,areaCode:J.value.areaCode,email:J.value.email,registerFrom:null==(e=H.state.channelInfo)?void 0:e.registerFrom,channel:null==(a=H.state.channelInfo)?void 0:a.channel,subChannel:null==(l=H.state.channelInfo)?void 0:l.subChannel}).then((e=>{E.value=!1,200===e.data.code?(L.value=e.data.result,G.start(),1===q.value?q.value=2:q.value=3):L.value=e.data.message})).catch((e=>{E.value=!1,q.value=4}))}K();const L=a(""),N=()=>{if(F.value.code){if(/^\d{6}$/.test(F.value.code))return 1==z.value?(L.value="",E.value=!0,void A({...J.value,code:F.value.code,type:J.value.codeType}).then((e=>{var a;200===e.data.code?(H.commit("setUserinfo",e.data.result),H.commit("setAccessToken",null==(a=e.data.result)?void 0:a.token),g({url:"/pages/index/index"})):L.value=e.data.message})).catch((e=>{L.value=U("message.t1"),console.error(e)})).finally((()=>{G.stop(),E.value=!1}))):2==z.value?(L.value="",E.value=!0,void B({...J.value,code:F.value.code,type:J.value.codeType}).then((e=>{var a;if(200!==e.data.code)L.value=e.data.message;else{H.commit("setUserinfo",e.data.result),H.commit("setAccessToken",null==(a=e.data.result)?void 0:a.token),f({title:U("login.t25"),icon:"success",duration:2e3});let l=setTimeout((()=>{clearTimeout(l),g({url:"/pages/invite/download"})}),2e3)}})).catch((e=>{errorMsg.value=U("message.t1")})).finally((()=>{G.stop(),E.value=!1}))):3==z.value?(L.value="",E.value=!0,void M({...J.value,code:F.value.code,type:J.value.codeType}).then((e=>{if(200!==e.data.code)L.value=e.data.message;else{f({title:U("login.t26"),icon:"success",duration:2e3});let e=setTimeout((()=>{clearTimeout(e),p({url:"/pages/login/login"})}),2e3)}})).catch((e=>{errorMsg.value=U("message.t1")})).finally((()=>{G.stop(),E.value=!1}))):void 0;L.value=U("login.t24")}else L.value=U("login.t23")};return(e,a)=>{const l=w(h("uni-nav-bar"),T),u=w(h("uni-icons"),$),g=_,f=n,p=y,C=b("van-button"),I=k,j=w(h("w-loading"),x);return t(),s(f,{class:"ano-page ano-login"},{default:o((()=>[i(l,{class:"ano-statusBar","background-color":"transparent",statusBar:!0,border:!1,height:"0"}),d("div",{class:"login-header"},[i(u,{type:"left",onClick:V})]),i(f,{class:"login-title"},{default:o((()=>[i(g,{class:"t1"},{default:o((()=>[c(r(e.$t("login.t15")),1)])),_:1})])),_:1}),i(f,{class:"login-tips"},{default:o((()=>[i(g,{class:"t1"},{default:o((()=>[c(r(e.$t("login.t16",[v(J).areaCode,v(J).mobile])),1)])),_:1})])),_:1}),i(f,{class:"login-form"},{default:o((()=>[i(f,{class:"form-row form-row-phone"},{default:o((()=>[i(f,{class:"input-wrap"},{default:o((()=>[i(f,{class:"phone-num"},{default:o((()=>[i(p,{class:"uni-input",type:"number",maxlength:"6",modelValue:F.value.code,"onUpdate:modelValue":a[0]||(a[0]=e=>F.value.code=e),placeholder:e.$t("login.t17")},null,8,["modelValue","placeholder"]),F.value.code.length>0?(t(),s(u,{key:0,type:"close",onClick:a[1]||(a[1]=e=>{return a="code",void(F.value[a]="");var a})})):m("",!0)])),_:1}),D.value>0?(t(),s(g,{key:0,class:"btn-code"},{default:o((()=>[c(r(e.$t("login.t18"))+"（"+r(D.value)+"）",1)])),_:1})):D.value<=0&&1===q.value?(t(),s(g,{key:1,class:"btn-code",onClick:K},{default:o((()=>[c(r(e.$t("login.t19")),1)])),_:1})):(t(),s(g,{key:2,class:"btn-code",onClick:K},{default:o((()=>[c(r(e.$t("login.t20")),1)])),_:1}))])),_:1})])),_:1})])),_:1}),i(f,{class:"login-errorMessage"},{default:o((()=>[L.value?(t(),s(g,{key:0,class:"t1"},{default:o((()=>[c(r(L.value),1)])),_:1})):m("",!0)])),_:1}),i(f,{class:"login-handle"},{default:o((()=>[i(C,{class:"login-btn",color:"#1f1f1f",disabled:!F.value.code,onClick:N},{default:o((()=>[c(r(e.$t("login.t21")),1)])),_:1},8,["disabled"])])),_:1}),i(f,{class:"login-issue"},{default:o((()=>[i(I,{url:"/pages/login/registe",class:"forget-new","hover-class":"navigator-hover"},{default:o((()=>[i(g,{type:"default"},{default:o((()=>[c(r(e.$t("login.t22")),1)])),_:1})])),_:1})])),_:1}),i(j,{show:E.value},null,8,["show"])])),_:1})}}},[["__scopeId","data-v-dc2c71aa"]]);export{U as default};
